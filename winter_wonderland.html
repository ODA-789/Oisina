<DOCTYPE html>
  <html>
    <head>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
      <title>Winter Wonderland Game</title>
    </head>
    <body>
      <script>
        function draw() {
  if (life > 0) {
    background(0);

    image(bg, 400, 400);
    image(man, 750, 750);

    textSize(30);
    text("Lives: " + life, 70, 30);
    text("Score: " + score, 200, 30);

    if (score > int(highScore[0])) {
      highScore[0] = str(score);
      saveStrings("highScore.txt", highScore);
    }

    // Kid 1 and Ball 1
    if (existk == true) {
      image(kid, xPosk, yPosk);
    }
    if (existb == true) {
      fill(255);
      ellipse(xPosb, yPosb, 30, 30);
      moveBall(xPosb, yPosb, 640, 670);
    }
    if (existb == false && existk == true) {
      cooldownb++;
    }

    if (cooldownb == 100) {
      xPosb = xPosk;
      yPosb = yPosk;
    }

    if (cooldownb >= 100) {
      existb = true;
      cooldownb = 0;
    }

    // Kid 2 and Ball 2 (Repeat for other kids/balls)
    if (existk1 == true) {
      image(kid, xPosk1, yPosk1);
    }
    if (existb1 == true) {
      fill(255);
      ellipse(xPosb1, yPosb1, 30, 30);
      moveBall(xPosb1, yPosb1, 640, 670);
    }
    if (existb1 == false && existk1 == true) {
      cooldownb1++;
    }

    if (cooldownb1 == 100) {
      xPosb1 = xPosk1;
      yPosb1 = yPosk1;
    }

    if (cooldownb1 >= 100) {
      existb1 = true;
      cooldownb1 = 0;
    }

    // Kid 3 and Ball 3 (Repeat for other kids/balls)
    if (existk2 == true) {
      image(kid, xPosk2, yPosk2);
    }
    if (existb2 == true) {
      fill(255);
      ellipse(xPosb2, yPosb2, 30, 30);
      moveBall(xPosb2, yPosb2, 640, 670);
    }
    if (existb2 == false && existk2 == true) {
      cooldownb2++;
    }

    if (cooldownb2 == 100) {
      xPosb2 = xPosk2;
      yPosb2 = yPosk2;
    }

    if (cooldownb2 >= 100) {
      existb2 = true;
      cooldownb2 = 0;
    }

    // Kid 4 and Ball 4 (Repeat for other kids/balls)
    if (existk3 == true) {
      image(kid, xPosk3, yPosk3);
    }
    if (existb3 == true) {
      fill(255);
      ellipse(xPosb3, yPosb3, 30, 30);
      moveBall(xPosb3, yPosb3, 640, 670);
    }
    if (existb3 == false && existk3 == true) {
      cooldownb3++;
    }

    if (cooldownb3 == 100) {
      xPosb3 = xPosk3;
      yPosb3 = yPosk3;
    }

    if (cooldownb3 >= 100) {
      existb3 = true;
      cooldownb3 = 0;
    }

    // Snowflake logic (remains unchanged)
    for (let i = 0; i < xPosArray.length; i++) {
      fill('#CAFAFF');
      shape(snow, xPosArray[i], yPosArray[i], sizeArray[i], sizeArray[i]);
      yPosArray[i] += speedArray[i];
      xPosArray[i] += speedArray[i];

      if (yPosArray[i] > 800) {
        yPosArray[i] = 0;
      }

      if (yPosArray[i] > 622 && xPosArray[i] > 640) {
        cornerFix = random(0, 6);
        if (cornerFix > 2) {
          yPosArray[i] = random(0, 178);
          xPosArray[i] = random(0, 160);
        } else if (cornerFix > 1 && cornerFix < 2) {
          yPosArray[i] = random(700, 800);
          xPosArray[i] = random(0, 100);
        } else if (cornerFix < 1) {
          yPosArray[i] = random(0, 100);
          xPosArray[i] = random(700, 800);
        }
      }

      if (xPosArray[i] > 800) {
        xPosArray[i] = 0;
      }
    }

    // Collision detection and score/life management
    handleCollisions();
  } else if (life <= 0) {
    gameOver();
  }
}

// Handle mouse click logic to check for collisions
function handleCollisions() {
  if (mouseIsPressed) {
    // Check for Kid 1 and Ball 1
    if (dist(mouseX, mouseY, xPosb, yPosb) < 15 && existb == true) {
      score += 10;
      existb = false; // Deactivate ball
    }

    // Check for Kid 2 and Ball 2
    if (dist(mouseX, mouseY, xPosb1, yPosb1) < 15 && existb1 == true) {
      score += 10;
      existb1 = false; // Deactivate ball
    }

    // Check for Kid 3 and Ball 3
    if (dist(mouseX, mouseY, xPosb2, yPosb2) < 15 && existb2 == true) {
      score += 10;
      existb2 = false; // Deactivate ball
    }

    // Check for Kid 4 and Ball 4
    if (dist(mouseX, mouseY, xPosb3, yPosb3) < 15 && existb3 == true) {
      score += 10;
      existb3 = false; // Deactivate ball
    }

    // Check for Kid 1
    if (dist(mouseX, mouseY, xPosk, yPosk) < 30 && existk == true) {
      life -= 1; // Decrease life
      existk = false; // Deactivate kid
    }

    // Check for Kid 2
    if (dist(mouseX, mouseY, xPosk1, yPosk1) < 30 && existk1 == true) {
      life -= 1;
      existk1 = false;
    }

    // Check for Kid 3
    if (dist(mouseX, mouseY, xPosk2, yPosk2) < 30 && existk2 == true) {
      life -= 1;
      existk2 = false;
    }

    // Check for Kid 4
    if (dist(mouseX, mouseY, xPosk3, yPosk3) < 30 && existk3 == true) {
      life -= 1;
      existk3 = false;
    }
  }
}

// Reset the game when 'Restart' is clicked
function mouseReleased() {
  if (life <= 0 && mouseX >= 300 && mouseX <= 500 && mouseY >= 500 && mouseY <= 600) {
    resetGame();
  }
}

function gameOver() {
  fill(255, 0, 0);
  rect(400, 400, 800, 800);

  fill(0);
  textSize(100);
  text("GAME OVER", 400, 250);
  textSize(30);
  text("Your score was " + score, 400, 400);
  text("The highscore is " + highScore[0], 400, 450);

  fill(0, 0, 255);
  rect(400, 550, 200, 100);
  fill(0);
  text("Restart", 400, 550);
}

function resetGame() {
  // Reset the game variables
  xPosk = random(150, 650);
  yPosk = random(100, 500);
  xPosb = xPosk;
  yPosb = yPosk;

  xPosk1 = random(150, 650);
  yPosk1 = random(100, 500);
  xPosb1 = xPosk1;
  yPosb1 = yPosk1;

  xPosk2 = random(150, 650);
  yPosk2 = random(100, 500);
  xPosb2 = xPosk2;
  yPosb2 = yPosk2;

  xPosk3 = random(150, 650);
  yPosk3 = random(100, 500);
  xPosb3 = xPosk3;
  yPosb3 = yPosk3;

  life = 5;
  speed = 0.5;
  speed1 = 0.5;
  speed2 = 0.5;
  speed3 = 0.5;

  existb = true;
  existk = true;
  existb1 = true;
  existk1 = true;
  existb2 = true;
  existk2 = true;
  existb3 = true;
  existk3 = true;

  score = 0;
}

  function snowflake() {
  snow=createShape();
  snow.beginShape();

  //up line
  snow.vertex(0, 0);
  snow.vertex(50, 0);

  //up flakes 1
  snow.vertex(50, 45);
  snow.vertex(100, 0);
  snow.vertex(125, 20);
  snow.vertex(50, 95);

  snow.vertex(50, 125);
  snow.vertex(100, 80);
  snow.vertex(125, 100);
  snow.vertex(50, 175);

  //right line 1
  snow.vertex(50, 225);

  //right flakes 1
  snow.vertex(95, 225);
  snow.vertex(135, 175);
  snow.vertex(165, 195);
  snow.vertex(145, 225);

  snow.vertex(175, 225);
  snow.vertex(215, 175);
  snow.vertex(245, 195);
  snow.vertex(225, 225);

  //right line 2
  snow.vertex(300, 225);
  snow.vertex(300, 275);

  //right flakes 2
  snow.vertex(225, 275);
  snow.vertex(245, 305);
  snow.vertex(215, 325);
  snow.vertex(175, 275);

  snow.vertex(145, 275);
  snow.vertex(165, 305);
  snow.vertex(135, 325);
  snow.vertex(95, 275);

  //right line 3
  snow.vertex(50, 275);

  //down flakes 1
  snow.vertex(50, 325);
  snow.vertex(125, 420);
  snow.vertex(100, 440);
  snow.vertex(50, 375);

  snow.vertex(50, 405);
  snow.vertex(125, 500);
  snow.vertex(100, 520);
  snow.vertex(50, 455);

  //down line
  snow.vertex(50, 500);
  snow.vertex(0, 500);

  //down flakes 2
  snow.vertex(0, 455);
  snow.vertex(-50, 520);
  snow.vertex(-75, 500);
  snow.vertex(0, 405);

  snow.vertex(0, 375);
  snow.vertex(-50, 440);
  snow.vertex(-75, 420);
  snow.vertex(0, 325);

  //left line
  snow.vertex(0, 275);

  //left flakes 1
  snow.vertex(-145, 275);
  snow.vertex(-165, 305);
  snow.vertex(-135, 325);
  snow.vertex(-95, 275);

  snow.vertex(-225, 275);
  snow.vertex(-245, 305);
  snow.vertex(-215, 325);
  snow.vertex(-175, 275);

  //left line 1
  snow.vertex(-250, 275);
  snow.vertex(-250, 225);

  //left flakes 2
  snow.vertex(-175, 225);
  snow.vertex(-215, 175);
  snow.vertex(-245, 195);
  snow.vertex(-225, 225);

  snow.vertex(-95, 225);
  snow.vertex(-135, 175);
  snow.vertex(-165, 195);
  snow.vertex(-145, 225);

  //left line 2
  snow.vertex(0, 225);

  //up flakes 2
  snow.vertex(0,175);
  snow.vertex(-75,100);
  snow.vertex(-50,80);
  snow.vertex(0,125);
  
  snow.vertex(0,95);
  snow.vertex(-75,20);
  snow.vertex(-50,0);
  snow.vertex(0,45);

  snow.endShape(CLOSE);
}
      </script>
    </body>
  </html>
